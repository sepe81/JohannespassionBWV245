<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Ãœbungsaufnahmen der ChorÃ¤le aus Bachs Johannespassion BWV 245 â€“ aufgeteilt nach Stimmen (S, A, T, B).">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽµ</text></svg>">
<title>ChorÃ¤le - Johannespassion BWV 245, FÃ¼r den Chor der Pauluskirchgemeinde</title>

<link rel="stylesheet" href="styles.css">
</head>
<body>

<a href="#main-content" class="sr-only sr-only-focusable">Zur Choralliste springen</a>

<header>
<h1>ChorÃ¤le Â· Johannespassion BWV 245</h1>
<p>Johann Sebastian Bach Â· UrauffÃ¼hrung <time datetime="1724-04-07" aria-label="7. April 1724">7. April 1724</time></p>
</header>

<p class="focus-link-bar" id="focus-link-bar" hidden>
  <a href="#" id="focus-link"></a>
</p>

<p class="tip-text">ðŸ’¡ Tipp: Auf die Choralnummer klicken, um das Notenblatt (PDF) zu Ã¶ffnen.</p>

<div class="voice-pref" role="group" aria-label="Bevorzugte Stimme auswÃ¤hlen">
    <span>Meine Stimme:</span>
    <button class="voice-btn" data-voice="S" aria-pressed="false">Sopran</button>
    <button class="voice-btn" data-voice="A" aria-pressed="false">Alt</button>
    <button class="voice-btn" data-voice="T" aria-pressed="false">Tenor</button>
    <button class="voice-btn" data-voice="B" aria-pressed="false">Bass</button>
    <label class="voice-autoplay-label">
        <input type="checkbox" id="voice-autoplay">
        Autoplay
    </label>
    <span class="voice-pref-hint" id="voice-pref-hint" aria-live="polite"></span>
</div>

<main id="main-content">
<table>
<caption class="sr-only">ChorÃ¤le aus der Johannespassion BWV 245 nach Stimmen (Sopran, Alt, Tenor, Bass)</caption>
<thead>
<tr>
<th scope="col">Nr.</th>
<th scope="col">S</th>
<th scope="col">A</th>
<th scope="col">T</th>
<th scope="col">B</th>
</tr>
</thead>
<tbody>

<!-- 7 -->
<tr data-nr="7">
<td><a href="https://www.tobis-notenarchiv.de/bach/05-Passionen/02-Johannespassion/BWV_0245_03.pdf" target="_blank" rel="noopener noreferrer" aria-label="Nr. 7 â€“ Notenblatt (PDF, tobis-notenarchiv.de)">7</a></td>
<td><audio controls preload="none" src="audio/nr7-S.m4a" aria-label="Nr. 7 â€“ Sopran"></audio></td>
<td><audio controls preload="none" src="audio/nr7-A.m4a" aria-label="Nr. 7 â€“ Alt"></audio></td>
<td><audio controls preload="none" src="audio/nr7-T.m4a" aria-label="Nr. 7 â€“ Tenor"></audio></td>
<td><audio controls preload="none" src="audio/nr7-B.m4a" aria-label="Nr. 7 â€“ Bass"></audio></td>
</tr>

<!-- 9 -->
<tr data-nr="9">
<td><a href="https://www.tobis-notenarchiv.de/bach/05-Passionen/02-Johannespassion/BWV_0245_05.pdf" target="_blank" rel="noopener noreferrer" aria-label="Nr. 9 â€“ Notenblatt (PDF, tobis-notenarchiv.de)">9</a></td>
<td><audio controls preload="none" src="audio/nr9-S.m4a" aria-label="Nr. 9 â€“ Sopran"></audio></td>
<td><audio controls preload="none" src="audio/nr9-A.m4a" aria-label="Nr. 9 â€“ Alt"></audio></td>
<td><audio controls preload="none" src="audio/nr9-T.m4a" aria-label="Nr. 9 â€“ Tenor"></audio></td>
<td><audio controls preload="none" src="audio/nr9-B.m4a" aria-label="Nr. 9 â€“ Bass"></audio></td>
</tr>

<!-- 15 -->
<tr data-nr="15">
<td><a href="https://www.tobis-notenarchiv.de/bach/05-Passionen/02-Johannespassion/BWV_0245_11.pdf" target="_blank" rel="noopener noreferrer" aria-label="Nr. 15 â€“ Notenblatt (PDF, tobis-notenarchiv.de)">15</a></td>
<td><audio controls preload="none" src="audio/nr15-S.m4a" aria-label="Nr. 15 â€“ Sopran"></audio></td>
<td><audio controls preload="none" src="audio/nr15-A.m4a" aria-label="Nr. 15 â€“ Alt"></audio></td>
<td><audio controls preload="none" src="audio/nr15-T.m4a" aria-label="Nr. 15 â€“ Tenor"></audio></td>
<td><audio controls preload="none" src="audio/nr15-B.m4a" aria-label="Nr. 15 â€“ Bass"></audio></td>
</tr>

<!-- 20 -->
<tr data-nr="20">
<td><a href="https://www.tobis-notenarchiv.de/bach/05-Passionen/02-Johannespassion/BWV_0245_14.pdf" target="_blank" rel="noopener noreferrer" aria-label="Nr. 20 â€“ Notenblatt (PDF, tobis-notenarchiv.de)">20</a></td>
<td><audio controls preload="none" src="audio/nr20-S.m4a" aria-label="Nr. 20 â€“ Sopran"></audio></td>
<td><audio controls preload="none" src="audio/nr20-A.m4a" aria-label="Nr. 20 â€“ Alt"></audio></td>
<td><audio controls preload="none" src="audio/nr20-T.m4a" aria-label="Nr. 20 â€“ Tenor"></audio></td>
<td><audio controls preload="none" src="audio/nr20-B.m4a" aria-label="Nr. 20 â€“ Bass"></audio></td>
</tr>

<!-- 21 -->
<tr data-nr="21">
<td><a href="https://www.tobis-notenarchiv.de/bach/05-Passionen/02-Johannespassion/BWV_0245_15.pdf" target="_blank" rel="noopener noreferrer" aria-label="Nr. 21 â€“ Notenblatt (PDF, tobis-notenarchiv.de)">21</a></td>
<td><audio controls preload="none" src="audio/nr21-S.m4a" aria-label="Nr. 21 â€“ Sopran"></audio></td>
<td><audio controls preload="none" src="audio/nr21-A.m4a" aria-label="Nr. 21 â€“ Alt"></audio></td>
<td><audio controls preload="none" src="audio/nr21-T.m4a" aria-label="Nr. 21 â€“ Tenor"></audio></td>
<td><audio controls preload="none" src="audio/nr21-B.m4a" aria-label="Nr. 21 â€“ Bass"></audio></td>
</tr>

<!-- 27 -->
<tr data-nr="27">
<td><a href="https://www.tobis-notenarchiv.de/bach/05-Passionen/02-Johannespassion/BWV_0245_17.pdf" target="_blank" rel="noopener noreferrer" aria-label="Nr. 27 â€“ Notenblatt (PDF, tobis-notenarchiv.de)">27</a></td>
<td><audio controls preload="none" src="audio/nr27-S.m4a" aria-label="Nr. 27 â€“ Sopran"></audio></td>
<td><audio controls preload="none" src="audio/nr27-A.m4a" aria-label="Nr. 27 â€“ Alt"></audio></td>
<td><audio controls preload="none" src="audio/nr27-T.m4a" aria-label="Nr. 27 â€“ Tenor"></audio></td>
<td><audio controls preload="none" src="audio/nr27-B.m4a" aria-label="Nr. 27 â€“ Bass"></audio></td>
</tr>

<!-- 40 -->
<tr data-nr="40">
<td><a href="https://www.tobis-notenarchiv.de/bach/05-Passionen/02-Johannespassion/BWV_0245_22.pdf" target="_blank" rel="noopener noreferrer" aria-label="Nr. 40 â€“ Notenblatt (PDF, tobis-notenarchiv.de)">40</a></td>
<td><audio controls preload="none" src="audio/nr40-S.m4a" aria-label="Nr. 40 â€“ Sopran"></audio></td>
<td><audio controls preload="none" src="audio/nr40-A.m4a" aria-label="Nr. 40 â€“ Alt"></audio></td>
<td><audio controls preload="none" src="audio/nr40-T.m4a" aria-label="Nr. 40 â€“ Tenor"></audio></td>
<td><audio controls preload="none" src="audio/nr40-B.m4a" aria-label="Nr. 40 â€“ Bass"></audio></td>
</tr>

<!-- 52 -->
<tr data-nr="52">
<td><a href="https://www.tobis-notenarchiv.de/bach/05-Passionen/02-Johannespassion/BWV_0245_26.pdf" target="_blank" rel="noopener noreferrer" aria-label="Nr. 52 â€“ Notenblatt (PDF, tobis-notenarchiv.de)">52</a></td>
<td><audio controls preload="none" src="audio/nr52-S.m4a" aria-label="Nr. 52 â€“ Sopran"></audio></td>
<td><audio controls preload="none" src="audio/nr52-A.m4a" aria-label="Nr. 52 â€“ Alt"></audio></td>
<td><audio controls preload="none" src="audio/nr52-T.m4a" aria-label="Nr. 52 â€“ Tenor"></audio></td>
<td><audio controls preload="none" src="audio/nr52-B.m4a" aria-label="Nr. 52 â€“ Bass"></audio></td>
</tr>

<!-- 56 -->
<tr data-nr="56">
<td><a href="https://www.tobis-notenarchiv.de/bach/05-Passionen/02-Johannespassion/BWV_0245_28.pdf" target="_blank" rel="noopener noreferrer" aria-label="Nr. 56 â€“ Notenblatt (PDF, tobis-notenarchiv.de)">56</a></td>
<td><audio controls preload="none" src="audio/nr56-S.m4a" aria-label="Nr. 56 â€“ Sopran"></audio></td>
<td><audio controls preload="none" src="audio/nr56-A.m4a" aria-label="Nr. 56 â€“ Alt"></audio></td>
<td><audio controls preload="none" src="audio/nr56-T.m4a" aria-label="Nr. 56 â€“ Tenor"></audio></td>
<td><audio controls preload="none" src="audio/nr56-B.m4a" aria-label="Nr. 56 â€“ Bass"></audio></td>
</tr>

<!-- 65 -->
<tr data-nr="65">
<td><a href="https://www.tobis-notenarchiv.de/bach/05-Passionen/02-Johannespassion/BWV_0245_37.pdf" target="_blank" rel="noopener noreferrer" aria-label="Nr. 65 â€“ Notenblatt (PDF, tobis-notenarchiv.de)">65</a></td>
<td><audio controls preload="none" src="audio/nr65-S.m4a" aria-label="Nr. 65 â€“ Sopran"></audio></td>
<td><audio controls preload="none" src="audio/nr65-A.m4a" aria-label="Nr. 65 â€“ Alt"></audio></td>
<td><audio controls preload="none" src="audio/nr65-T.m4a" aria-label="Nr. 65 â€“ Tenor"></audio></td>
<td><audio controls preload="none" src="audio/nr65-B.m4a" aria-label="Nr. 65 â€“ Bass"></audio></td>
</tr>

<!-- 68 -->
<tr data-nr="68">
<td><a href="https://www.tobis-notenarchiv.de/bach/05-Passionen/02-Johannespassion/BWV_0245_40.pdf" target="_blank" rel="noopener noreferrer" aria-label="Nr. 68 â€“ Notenblatt (PDF, tobis-notenarchiv.de)">68</a></td>
<td><audio controls preload="none" src="audio/nr68-S.m4a" aria-label="Nr. 68 â€“ Sopran"></audio></td>
<td><audio controls preload="none" src="audio/nr68-A.m4a" aria-label="Nr. 68 â€“ Alt"></audio></td>
<td><audio controls preload="none" src="audio/nr68-T.m4a" aria-label="Nr. 68 â€“ Tenor"></audio></td>
<td><audio controls preload="none" src="audio/nr68-B.m4a" aria-label="Nr. 68 â€“ Bass"></audio></td>
</tr>

</tbody>
</table>
</main>

<footer>
    <p>Die Johannespassion BWV 245 wurde am <strong><time datetime="1724-04-07" aria-label="7. April 1724">7.Â April 1724</time></strong> in der Thomaskirche Leipzig uraufgefÃ¼hrt â€” Bachs erstes groÃŸes Passionswerk als Thomaskantor.</p>
    <p>Das Werk gliedert sich in Rezitative, Arien, ChÃ¶re und ChorÃ¤le. <strong>Nr. 1 ist der Eingangschor</strong> (â€žHerr, unser Herrscherâ€œ); der erste Choral erscheint erst als Nr. 7 (â€žO groÃŸe Liebâ€œ). Die LÃ¼cken in der Nummerierung â€” also fehlende Nummern zwischen den ChorÃ¤len â€” sind keine Auslassungen, sondern Rezitative, Arien und ChÃ¶re.</p>
    <p>Die Nummern folgen der <strong>Bach-Gesellschaft-Ausgabe (BG)</strong>, der historischen Gesamtausgabe, und stimmen mit den meisten gedruckten Partituren Ã¼berein.</p>
    <p>NotenblÃ¤tter: <a href="https://tobis-notenarchiv.de/wp/en/bach-archive/vocal-works/passions/st-john-passion/" target="_blank" rel="noopener noreferrer">Tobis Notenarchiv</a>, lizenziert unter <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener noreferrer">CC BY-NC 4.0</a>.</p>
</footer>

<script src="lyrics.js"></script>
<script>
// Inject lyrics rows and enrich PDF links with chorale title
document.querySelectorAll("tr[data-nr]").forEach(row => {
    const nr = Number(row.dataset.nr);
    if (!LYRICS[nr]) return;

    const incipit = LYRICS[nr].split("\n")[0].replace(/,$/, "");
    const link = row.cells[0].querySelector("a");
    if (link) {
        link.setAttribute("aria-label", link.getAttribute("aria-label").replace(" â€“ Notenblatt", ` \u201e${incipit}\u201c â€“ Notenblatt`));
        link.title = incipit;
    }

    const lyricsRow = document.createElement("tr");
    lyricsRow.className = "lyrics-row";
    lyricsRow.dataset.for = String(nr);
    lyricsRow.setAttribute("aria-hidden", "true");
    const td = document.createElement("td");
    td.colSpan = 5;
    td.innerHTML = LYRICS[nr].replaceAll("\n", "<br>");
    lyricsRow.appendChild(td);
    row.after(lyricsRow);
});

const players = document.querySelectorAll("audio");

players.forEach(player => {
    player.addEventListener("play", () => {
        players.forEach(other => {
            if (other !== player) other.pause();
        });
        // Show lyrics for the active row, hide all others
        const activeRow = player.closest("tr[data-nr]");
        const activeNr = activeRow && activeRow.dataset.nr;
        document.querySelectorAll(".lyrics-row").forEach(row => {
            const isActive = row.dataset.for === activeNr;
            row.classList.toggle("active", isActive);
            row.setAttribute("aria-hidden", String(!isActive));
        });
    });
});

// StimmenprÃ¤ferenz
const VOICE_IDX = { S: 0, A: 1, T: 2, B: 3 };
const VOICE_LABEL = { S: "Sopran", A: "Alt", T: "Tenor", B: "Bass" };
let preferredVoice = localStorage.getItem("preferredVoice") || "";
const voiceButtons = document.querySelectorAll(".voice-btn");
const voicePrefHint = document.getElementById("voice-pref-hint");
const autoplayCheckbox = document.getElementById("voice-autoplay");

// Default is enabled; only store when explicitly unchecked
autoplayCheckbox.checked = localStorage.getItem("voiceAutoplay") !== "false";

const focusVoice = new URLSearchParams(location.search).get("fokus");
const focusBar = document.getElementById("focus-link-bar");
const focusLink = document.getElementById("focus-link");

function updateVoiceUI() {
    voiceButtons.forEach(btn => {
        const active = btn.dataset.voice === preferredVoice;
        btn.classList.toggle("active", active);
        btn.setAttribute("aria-pressed", String(active));
    });
    const autoplayOn = autoplayCheckbox.checked;
    voicePrefHint.textContent = preferredVoice && autoplayOn
        ? "â†’ Beim Ã–ffnen des Notenblatts startet " + VOICE_LABEL[preferredVoice] + " nach 3\u00a0Sekunden"
        : "";
    updateFocusLink();
}

autoplayCheckbox.addEventListener("change", () => {
    localStorage.setItem("voiceAutoplay", autoplayCheckbox.checked);
    cancelAutoPlay();
    updateVoiceUI();
});

voiceButtons.forEach(btn => {
    btn.addEventListener("click", () => {
        preferredVoice = btn.dataset.voice === preferredVoice ? "" : btn.dataset.voice;
        localStorage.setItem("preferredVoice", preferredVoice);
        cancelAutoPlay();
        updateVoiceUI();
        if (focusVoice) {
            if (preferredVoice) {
                history.replaceState(null, "", `?fokus=${preferredVoice}`);
                document.querySelector("table").dataset.voice = preferredVoice;
                document.querySelector("thead th:nth-child(2)").textContent = VOICE_LABEL[preferredVoice];
            } else {
                history.replaceState(null, "", "index.html");
                delete document.querySelector("table").dataset.voice;
            }
        }
    });
});

updateVoiceUI();

// --- Fokus-Modus ---
function updateFocusLink() {
    if (focusVoice) return;
    if (preferredVoice) {
        focusBar.removeAttribute("hidden");
        focusLink.href = `?fokus=${preferredVoice}`;
        focusLink.textContent = `Nur ${VOICE_LABEL[preferredVoice]} â†’`;
    } else {
        focusBar.setAttribute("hidden", "");
    }
}

if (focusVoice && VOICE_IDX.hasOwnProperty(focusVoice)) {
    document.querySelector("table").dataset.voice = focusVoice;
    document.querySelector("thead th:nth-child(2)").textContent = VOICE_LABEL[focusVoice];
    focusBar.removeAttribute("hidden");
    focusLink.href = "index.html";
    focusLink.textContent = "â† Alle Stimmen anzeigen";
    preferredVoice = focusVoice;
    updateVoiceUI();
}

// Auto-play beim Ã–ffnen des Notenblatts
let autoPlayTimer = null;

function cancelAutoPlay() {
    if (autoPlayTimer) {
        clearTimeout(autoPlayTimer);
        autoPlayTimer = null;
    }
}

document.querySelectorAll("td:first-child a").forEach(link => {
    link.addEventListener("click", () => {
        cancelAutoPlay();
        if (!preferredVoice || !autoplayCheckbox.checked) return;
        const row = link.closest("tr[data-nr]");
        if (!row) return;
        const audios = row.querySelectorAll("audio");
        const audio = audios[VOICE_IDX[preferredVoice]];
        if (!audio || !audio.src) return;
        autoPlayTimer = setTimeout(() => {
            players.forEach(p => { if (p !== audio) p.pause(); });
            audio.play().catch(() => {}); // Ignore if play fails
            autoPlayTimer = null;
        }, 3000);
    });
});
</script>

</body>
</html>
